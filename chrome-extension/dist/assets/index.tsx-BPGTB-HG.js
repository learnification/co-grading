import{c as R,r as m,j as e,B as C,R as E,a as q,b as F}from"./createLucideIcon-D6pmb5t8.js";import{D as P,a as _,b as U,c as H,d as B,e as V,S as h,T as $,L as z,I as J,f as K,J as b,g as Q}from"./Textarea-CXtSScXf.js";import{u as W,g as w,a as X,b as Y,O as L,c as j,d as Z,T as N,e as ee}from"./canvasApi-B3XcU1Pv.js";import{p as te}from"./request-Bv5M4Dhc.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=R("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);function ae({initialSettings:a}){const[n,s]=m.useState(!1),[t,c]=m.useState(!1),[i,l]=m.useState(a??{strictness:"moderate",tone:"friendly",length:"short",customFeedbackPrompt:""}),[u,d]=m.useState(),M=async r=>{r.preventDefault(),s(!0);let o;if(u)try{o=await W(u)}catch{b.error("Error uploading document.",{description:"Please try again later."}),s(!1),c(!1);return}const T=window.location.pathname.split("/"),g=T[2],k=T[4],G=await w(g),O=await X(g,k),v=await Y(g,k);try{await te({course:G,assignment:O,submissions:v,settings:i,documentId:o});const p=v.length;b.success("Grading request submitted successfully!",{description:`${p} submission(s) are now being processed.`,action:{label:"View Status",onClick:()=>{chrome.runtime.sendMessage({type:L,payload:"#task"})}}})}catch{b.error("An error occurred while processing your request.",{description:"Please try again later."})}finally{s(!1),c(!1),d(void 0)}};return e.jsxs(P,{open:t,onOpenChange:c,children:[e.jsx(_,{asChild:!0,children:e.jsx(C,{variant:"outline",id:"ai-feedback-button",disabled:n,className:"inline-flex items-center px-[14px] py-[8px] m-[2px] text-[1rem] leading-[22px] bg-[#e11d48] text-white font-semibold rounded-[3px] border-[1px] border-solid border-sky-900 hover:bg-[#be123c] focus:outline-none focus:ring-2 focus:ring-blue-500",children:n?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"animate-spin h-5 w-5"}),e.jsx("span",{className:"ml-2",children:"Submitting"})]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsx("span",{className:"ml-2",children:"Autograde"})]})})}),e.jsxs(U,{className:"p-4 m-4",children:[e.jsxs(H,{children:[e.jsx(B,{children:"AI Settings"}),e.jsx(V,{children:"Configure the AI grading settings for this assignment."})]}),e.jsxs("div",{className:"grid mx-4",children:[e.jsx(h,{label:"Grading Strictness",options:["loose","moderate","strict"],defaultValue:i.strictness,onChange:r=>{l(o=>({...o,strictness:r}))}}),e.jsx(h,{label:"Feedback Tone",options:["formal","friendly","constructive"],defaultValue:i.tone,onChange:r=>{l(o=>({...o,tone:r}))}}),e.jsx(h,{label:"Feedback Length",options:["short","medium","detailed"],defaultValue:i.length,onChange:r=>{l(o=>({...o,length:r}))}}),e.jsx($,{label:"Custom Feedback Prompt",defaultValue:i.customFeedbackPrompt,onChange:r=>{l(o=>({...o,customFeedbackPrompt:r.target.value}))}}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"file",children:"Resources which may help the AI to grade better (optional)"}),e.jsx(J,{id:"file",type:"file",accept:".pdf,application/pdf",onChange:r=>{var o;d((o=r.target.files)==null?void 0:o[0])}})]})]}),e.jsx(K,{children:e.jsx(C,{type:"submit",onClick:M,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"animate-spin h-5 w-5"}),e.jsx("span",{className:"ml-2",children:"Submitting"})]}):"Submit"})})]})]})}const I="ai-feedback-button",D="ai-feedback-status",f=".assignment-buttons",x="#sidebar_content",ne=async()=>{const s=window.location.pathname.split("/")[4],t=document.createElement("div");t.className="p-4 m-4 bg-blue-100 text-blue-800 hover:cursor-pointer font-semibold text-lg rounded-lg shadow-md flex flex-wrap flex-row items-center justify-center",t.innerHTML=`
    <h2 class="text-center mb-1">AI Grading Status</h2>
`,t.id=D,t.addEventListener("click",()=>{chrome.runtime.sendMessage({type:L,payload:"#task"})});try{const l=(await ee({assignmentId:s})).flatMap(d=>d.request.submissions).map(d=>d.id),u=new Set(l).size;t.innerHTML+=`<p class="text-center" style="margin-bottom: 0;">${u} submissions graded</p>`}catch{t.innerHTML+='<p class="text-center" style="margin-bottom: 0;">Error fetching grading status</p>'}return t},y=async()=>{const a=document.querySelector(x);if(a&&!a.querySelector(`#${D}`)){const n=await ne();a.appendChild(n)}},A=()=>{const a=document.createElement("div");a.id="ai-feedback-toasts",q(a).render(e.jsx(Q,{richColors:!0})),document.body.appendChild(a)},S=async()=>{const a=document.querySelectorAll(f),n=await j(Z);a.forEach(s=>{if(!s.querySelector(`#${I}`)){const t=document.createElement("div");t.style.display="inline-flex",t.style.verticalAlign="middle",t.id=I,s.insertBefore(t,s.firstChild),F.createRoot(t).render(e.jsx(ae,{initialSettings:n==null?void 0:n.evaluation}))}})};(async()=>{const a=window.location.pathname.split("/")[2],n=await w(a),{type:s}=n.enrollments[0],t=s==="teacher"||s==="ta";await j(N)&&t&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",async()=>{await S(),A(),await y()}):(S(),A(),await y()))})();const oe=new MutationObserver(a=>{a.forEach(n=>{n.addedNodes.forEach(async s=>{const t=window.location.pathname.split("/")[2],c=await w(t),{type:i}=c.enrollments[0],l=i==="teacher"||i==="ta";!await j(N)||!l||s instanceof HTMLElement&&((s.matches(f)||s.querySelector(f))&&S(),(s.matches(x)||s.querySelector(x))&&await y())})})});oe.observe(document.body,{childList:!0,subtree:!0});
